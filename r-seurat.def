Bootstrap: docker
From: rocker/tidyverse:latest

# Optional: Add locally installed packages to rebuilt container
%files
    # Uncomment to copy tracking tools into container
    # r_tools/package_tracker.R /opt/r_tools/package_tracker.R
    
    # Create install_local_packages.R using generate_install_script()
    # This script can reinstall all your local packages into the container
    # install_local_packages.R /install_local_packages.R

%post
    # Update and install system dependencies
    apt-get update && apt-get install -y --no-install-recommends \
        libxml2-dev \
        libcurl4-openssl-dev \
        libssl-dev \
        libgit2-dev \
        libfontconfig1-dev \
        libharfbuzz-dev \
        libfribidi-dev \
        libhdf5-dev \
        libgeos-dev \
        libproj-dev \
        libgdal-dev \
        libudunits2-dev \
        libnode-dev \
        libcairo2-dev \
        libxt-dev \
        libglpk-dev \
        build-essential \
        cmake \
        pkg-config \
        gfortran \
        libblas-dev \
        liblapack-dev \
        libffi-dev \
        zlib1g-dev \
        libbz2-dev \
        liblzma-dev \
        libncurses5-dev \
        libreadline-dev \
        libsqlite3-dev \
        wget \
        curl \
        bzip2
    
    # Install essential R packages
    # remotes: for installing from various sources
    R -e "install.packages('remotes', repos='https://cloud.r-project.org/')"
    
    # jsonlite: required for tracking system
    R -e "install.packages('jsonlite', repos='https://cloud.r-project.org/')"
    
    # Install Seurat (your base requirement)
    R -e "install.packages('Seurat', repos='https://cloud.r-project.org/')"
    
    # Optional: Install project local packages into rebuilt container
    # These are libraries found in R_libs outside the container
    # Uncomment below to bake packages into the container:
    # Rscript /install_local_packages.R 
    
    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    # Set user library path to /project/R_libs (outside container)
    export R_LIBS_USER="/project/R_libs"
    export LC_ALL=C
    export LANG=C.UTF-8

%runscript
    exec "$@"

%labels
    Author YourName
    Version 2.0
    Description R container with RStudio, tidyverse, Seurat, and package tracking support
